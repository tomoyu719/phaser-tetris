# テトリス MVP 要件定義書

## 1. 概要

Phaser 3を使用したブラウザ向けテトリスゲームのMVP（Minimum Viable Product）。

### 1.1 目的
- 最小限の機能で遊べるテトリスを実装する
- 将来的な機能拡張の土台を作る

### 1.2 対象プラットフォーム
- PCブラウザ（Chrome, Firefox, Safari, Edge）
- モバイル対応は将来の拡張とする

---

## 2. 技術スタック

| 項目 | 技術 |
|------|------|
| ゲームエンジン | Phaser 3 |
| 言語 | TypeScript |
| ビルドツール | Vite |
| パッケージ管理 | npm |

---

## 3. 機能要件

### 3.1 ゲームフィールド

| 項目 | 仕様 |
|------|------|
| フィールドサイズ | 横10マス × 縦20マス |
| セルサイズ | 32px × 32px |
| 表示領域 | 320px × 640px（フィールド部分） |

### 3.2 テトリミノ

7種類の標準テトリミノを実装する。

| 名称 | 形状 | 色 |
|------|------|------|
| I | 横一直線（4マス） | シアン |
| O | 正方形（2×2） | 黄色 |
| T | T字型 | 紫 |
| S | S字型 | 緑 |
| Z | Z字型 | 赤 |
| J | J字型 | 青 |
| L | L字型 | オレンジ |

### 3.3 操作

キーボード操作のみ対応。

| キー | 動作 |
|------|------|
| ← (左矢印) | 左に1マス移動 |
| → (右矢印) | 右に1マス移動 |
| ↓ (下矢印) | ソフトドロップ（高速落下） |
| ↑ (上矢印) または Z | 左回転（反時計回り） |
| X | 右回転（時計回り） |

### 3.4 ゲームロジック

#### 3.4.1 落下
- テトリミノは一定間隔で1マスずつ自動落下する
- 落下間隔: 1000ms（1秒）
- ソフトドロップ時: 50ms間隔

#### 3.4.2 回転
- シンプルな回転（中心点を軸に90度回転）
- 壁蹴り（Wall Kick）は実装しない
- 回転後に壁や他ブロックと重なる場合は回転をキャンセル

#### 3.4.3 固定（ロック）
- テトリミノが着地後、次フレームで固定
- 固定後、新しいテトリミノが出現

#### 3.4.4 ライン消去
- 横一列が全て埋まったら消去
- 同時に複数ライン消去可能（1〜4ライン）
- 消去後、上のブロックが落下

#### 3.4.5 ゲームオーバー
- 新しいテトリミノが出現位置に配置できない場合

### 3.5 スコア

| 消去ライン数 | 得点 |
|-------------|------|
| 1ライン (Single) | 100点 |
| 2ライン (Double) | 300点 |
| 3ライン (Triple) | 500点 |
| 4ライン (Tetris) | 800点 |

### 3.6 UI表示

#### 3.6.1 必須表示項目
- ゲームフィールド
- 現在のスコア
- ネクストピース（1個）

#### 3.6.2 画面構成
```
+------------------+--------+
|                  | NEXT   |
|                  | [    ] |
|                  |        |
|    GAME FIELD    | SCORE  |
|    (10 x 20)     | 0      |
|                  |        |
|                  |        |
|                  |        |
+------------------+--------+
```

### 3.7 ゲームフロー

```
[タイトル画面] → [ゲーム画面] → [ゲームオーバー画面]
      ↑              ↓                  ↓
      ←──────────────←──────────────────←
                  (リトライ)
```

#### 3.7.1 タイトル画面
- ゲームタイトル表示
- 「PRESS SPACE TO START」表示
- スペースキーでゲーム開始

#### 3.7.2 ゲーム画面
- 上記UIを表示
- ゲームプレイ

#### 3.7.3 ゲームオーバー画面
- 「GAME OVER」表示
- 最終スコア表示
- 「PRESS SPACE TO RETRY」表示
- スペースキーでタイトルに戻る

---

## 4. 非機能要件

### 4.1 パフォーマンス
- 60FPSで動作すること

### 4.2 ブラウザ対応
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

---

## 5. MVP除外項目（将来拡張）

以下の機能はMVPに含めず、将来の拡張とする。

| 機能 | 優先度 | 備考 |
|------|--------|------|
| ゴーストピース | 高 | 落下位置プレビュー |
| ハードドロップ | 高 | 即座に落下 |
| ホールド機能 | 中 | ピースを一時保存 |
| レベルシステム | 中 | 速度上昇 |
| Wall Kick (SRS) | 中 | 高度な回転システム |
| ハイスコア保存 | 中 | LocalStorage使用 |
| 効果音 | 低 | 各種SE |
| BGM | 低 | ゲーム中の音楽 |
| モバイル対応 | 低 | タッチ操作 |
| T-Spin | 低 | ボーナススコア |

---

## 6. ディレクトリ構成（予定）

```
phaser_tetris/
├── docs/
│   └── REQUIREMENTS.md    # 本ドキュメント
├── src/
│   ├── main.ts            # エントリーポイント
│   ├── config.ts          # ゲーム設定
│   ├── scenes/
│   │   ├── TitleScene.ts  # タイトル画面
│   │   ├── GameScene.ts   # ゲーム画面
│   │   └── GameOverScene.ts # ゲームオーバー画面
│   ├── objects/
│   │   ├── Tetromino.ts   # テトリミノクラス
│   │   ├── Board.ts       # ゲームボードクラス
│   │   └── Block.ts       # 単一ブロッククラス
│   └── constants/
│       └── tetrominos.ts  # テトリミノ定義
├── public/
│   └── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

---

## 7. 改訂履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2025-01-21 | 1.0 | 初版作成 |
